<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…å–®ç¸½ç®¡</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f3460;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 { margin-bottom: 20px; }
    ul { list-style: none; padding: 0; }
    li {
      background: #16213e;
      margin: 10px auto;
      padding: 10px 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    a { color: #4a9eff; text-decoration: none; font-weight: bold; }
    button {
      background: #ff4757;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #e84118; }
    #addBtn {
      margin-top: 20px;
      background: linear-gradient(45deg, #4a9eff, #ff6b9d);
    }
  </style>
</head>
<body>
  <h1>ğŸ“‚ æˆ‘çš„æ¸…å–®</h1>
  <ul id="listContainer"></ul>
  <button id="addBtn">â• æ–°å¢æ¸…å–®</button>

   <script>
      const container = document.getElementById("listContainer");
      
      // é—œéµä¿®æ­£ 1: ç¢ºä¿ ID å¸¶æœ‰ 'list_' å‰ç¶´ (é€™æ˜¯å­æ¸…å–®ä¾è³´çš„åŸºç¤ ID)
      function generateId() {
        // ç”¢ç”Ÿé¡ä¼¼ 'list_1727339064000123' çš„ ID
        return 'list_' + Date.now() + '' + Math.floor(Math.random() * 1000);
      }
      
      // é—œéµä¿®æ­£ 2: æ ¹æ“šå­æ¸…å–®çš„é›™ Key çµæ§‹è®€å–æ¨™é¡Œ
      function getAllLists() {
        const lists = [];
        const keys = [];
  
        // æ­¥é©Ÿ A: éæ­·æ‰€æœ‰ localStorage keys
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
  
          // æ­¥é©Ÿ B: éæ¿¾å‡ºæ¸…å–®çš„åŸºç¤ ID (ä¾‹å¦‚: "list_123")
          // å­æ¸…å–®å„²å­˜çš„ Keys æœƒæœ‰: "list_123_items" å’Œ "list_123_title"
          // æˆ‘å€‘éœ€è¦å¾é€™äº› keys ä¸­è§£æå‡ºå…±åŒçš„ "list_123"
          if (key.startsWith("list_")) {
              // è™•ç†æ¨™é¡Œ Key: ç§»é™¤ "_title" å°¾å·´
              if (key.endsWith("_title")) {
                  keys.push(key.replace("_title", ""));
              // è™•ç†å…§å®¹ Key: ç§»é™¤ "_items" å°¾å·´
              } else if (key.endsWith("_items")) {
                  keys.push(key.replace("_items", ""));
              // è™•ç†å¯èƒ½æ˜¯èˆŠç‰ˆæˆ–éŒ¯èª¤å„²å­˜çš„å–®ä¸€ Key (ç‚ºäº†é¿å…é‡è¤‡ï¼Œé€™è£¡å¯ä»¥å¿½ç•¥)
              } else {
                  // å¦‚æœå­æ¸…å–®ç¢ºå®šåªå­˜ items å’Œ title å…©å€‹ Keyï¼Œé€™è£¡å¯ä»¥å¿½ç•¥
                  // å¦‚æœæ‚¨ä¸ç¢ºå®šï¼Œå¯ä»¥åŠ ä¸Š keys.push(key);
              }
          }
        }
  
        // æ­¥é©Ÿ C: å»ºç«‹ä¸é‡è¤‡çš„åŸºç¤ ID æ¸…å–® (Set)
        const uniqueListIds = [...new Set(keys)];
  
        // æ­¥é©Ÿ D: æ ¹æ“šåŸºç¤ ID è®€å–æ¨™é¡Œ
        uniqueListIds.forEach(id => {
            // çµ„åˆå‡ºå­æ¸…å–®å„²å­˜æ¨™é¡Œçš„ Key
            const titleKey = id + "_title";
            const title = localStorage.getItem(titleKey);
  
            // é©—è­‰æ¨™é¡Œæ˜¯å¦å­˜åœ¨
            const listTitle = title && title.trim() !== "" ? title : "æœªå‘½åæ¸…å–®";
  
            // å°‡çµæœåŠ å…¥æ¸…å–®
            lists.push({ id: id, title: listTitle });
        });
  
        return lists;
      }
      
      function render() {
        const allLists = getAllLists();
        container.innerHTML = "";
        if (allLists.length === 0) {
            container.innerHTML = '<li style="justify-content: center; background: #16213e;">ç›®å‰æ²’æœ‰ä»»ä½•æ¸…å–®ã€‚</li>';
            return;
        }
        allLists.forEach(list => {
          const li = document.createElement("li");
          li.innerHTML = 
            `<a href="list.html?id=${encodeURIComponent(list.id)}">${list.title}</a>
            <button onclick="deleteList('${list.id}')">åˆªé™¤</button>`;
          container.appendChild(li);
        });
      }
  
      function addList() {
        const id = generateId();
        const defaultTitle = "æ–°æ¸…å–®"; // æ–°æ¸…å–®é è¨­æ¨™é¡Œ
        
        // é—œéµä¿®æ­£ 3: æ–°å¢æ¸…å–®æ™‚ï¼Œéœ€åŒæ­¥å»ºç«‹å­æ¸…å–®é æœŸçš„å…©å€‹ Key
        
        // 1. å„²å­˜é è¨­æ¨™é¡Œ (å­æ¸…å–®çš„ STORAGE_KEY_TITLE)
        localStorage.setItem(id + "_title", defaultTitle); 
        
        // 2. å„²å­˜é è¨­é …ç›® (å­æ¸…å–®çš„ STORAGE_KEY_ITEMS)
        // ç‚ºäº†é¿å…å­æ¸…å–®é¦–æ¬¡åŠ è¼‰éŒ¯èª¤ï¼Œæˆ‘å€‘å­˜ä¸€å€‹ç©ºé …ç›®é™£åˆ— ['']
        localStorage.setItem(id + "_items", JSON.stringify([''])); 
        
        render();
        // è‡ªå‹•æ‰“é–‹æ–°æ¸…å–®é é¢
        window.location.href = `list.html?id=${encodeURIComponent(id)}`;
      }
      
      // é—œéµä¿®æ­£ 4: åˆªé™¤æ¸…å–®æ™‚ï¼Œå¿…é ˆåŒæ­¥åˆªé™¤å­æ¸…å–®å„²å­˜çš„æ‰€æœ‰ç›¸é—œ Key
      function deleteList(id) {
        if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹æ¸…å–®å—ï¼Ÿ")) return;
        
        // åˆªé™¤æ¨™é¡Œ Key
        localStorage.removeItem(id + "_title");
        
        // åˆªé™¤é …ç›® Key
        localStorage.removeItem(id + "_items");
        
        // æ³¨æ„ï¼šç”±æ–¼æ‚¨çš„å­æ¸…å–®åªä½¿ç”¨é€™å…©å€‹ Keyï¼Œæˆ‘å€‘åªéœ€åˆªé™¤é€™å…©å€‹
        
        render();
      }
      
      document.getElementById("addBtn").addEventListener("click", addList);
      render();
  </script>
</body>
</html>
