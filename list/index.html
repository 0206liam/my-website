<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…å–®ç¸½ç®¡</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f3460;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 { margin-bottom: 20px; }
    ul { list-style: none; padding: 0; }
    li {
      background: #16213e;
      margin: 10px auto;
      padding: 10px 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    a { color: #4a9eff; text-decoration: none; font-weight: bold; }
    button {
      background: #ff4757;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #e84118; }
    #addBtn {
      margin-top: 20px;
      background: linear-gradient(45deg, #4a9eff, #ff6b9d);
    }
  </style>
</head>
<body>
  <h1>ğŸ“‚ æˆ‘çš„æ¸…å–®</h1>
  <ul id="listContainer"></ul>
  <button id="addBtn">â• æ–°å¢æ¸…å–®</button>

   <script>
    const container = document.getElementById("listContainer");
    
    // é—œéµä¿®æ­£ 1: ç¢ºä¿ ID å¸¶æœ‰ 'list_' å‰ç¶´ä¸”è¶³å¤ å”¯ä¸€
    function generateId() {
      // ä½¿ç”¨æ›´é•·çš„ ID ç¢ºä¿å”¯ä¸€æ€§
      return 'list_' + Date.now() + '' + Math.floor(Math.random() * 99999);
    }
    
    // é—œéµä¿®æ­£ 2: ç©©å¥åœ°è®€å–æ¸…å–®åˆ—è¡¨
    function getAllLists() {
      const lists = [];
      const idSet = new Set(); // ç”¨æ–¼å­˜å„²ä¸é‡è¤‡çš„åŸºç¤ ID

      // æ­¥é©Ÿ A: éæ­·æ‰€æœ‰ localStorage keysï¼Œå°‹æ‰¾æ‰€æœ‰æ¸…å–®çš„åŸºç¤ ID
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);

        if (key.startsWith("list_")) {
            let baseId = null;
            
            // å¾å­æ¸…å–®çš„ Key ä¸­è§£æå‡ºåŸºç¤ ID (list_XXX)
            if (key.endsWith("_title")) {
                baseId = key.replace("_title", "");
            } else if (key.endsWith("_items")) {
                baseId = key.replace("_items", "");
            }
            
            // åªæœ‰æˆåŠŸè§£æå‡ºåŸºç¤ ID æ‰åŠ å…¥ Set
            if (baseId) {
                idSet.add(baseId);
            }
        }
      }

      // æ­¥é©Ÿ B: æ ¹æ“šåŸºç¤ ID è®€å–æ¨™é¡Œï¼Œä¸¦ç¢ºèªæ¸…å–®å…§å®¹æ˜¯å¦å­˜åœ¨
      idSet.forEach(id => {
          const titleKey = id + "_title";
          const itemsKey = id + "_items";

          // è®€å–æ¨™é¡Œ (å¦‚æœä¸å­˜åœ¨ï¼Œå‰‡ç‚º null)
          const title = localStorage.getItem(titleKey);
          
          // è®€å–æ¸…å–®é …ç›® (ç”¨æ–¼é©—è­‰æ¸…å–®æ˜¯å¦ç‚ºç©º/æœ‰æ•ˆ)
          const items = localStorage.getItem(itemsKey);

          // åªæœ‰ç•¶è‡³å°‘æœ‰æ¨™é¡Œ Key æˆ–å…§å®¹ Key å­˜åœ¨æ™‚ï¼Œæ‰è¦–ç‚ºæœ‰æ•ˆæ¸…å–®
          if (title !== null || items !== null) {
              // å¦‚æœæ¨™é¡Œç‚º null æˆ–ç©ºå­—ä¸²ï¼Œå‰‡ä½¿ç”¨é è¨­å€¼
              const listTitle = (title && title.trim() !== "") ? title : "æœªå‘½åæ¸…å–®";
              
              // åŠ å…¥åˆ—è¡¨
              lists.push({ id: id, title: listTitle });
          }
      });

      return lists;
    }
    
    function render() {
      const allLists = getAllLists();
      container.innerHTML = "";
      if (allLists.length === 0) {
          container.innerHTML = '<li style="justify-content: center; background: #16213e;">ç›®å‰æ²’æœ‰ä»»ä½•æ¸…å–®ã€‚</li>';
          return;
      }
      allLists.forEach(list => {
        const li = document.createElement("li");
        li.innerHTML = 
          `<a href="list.html?id=${encodeURIComponent(list.id)}">${list.title}</a>
          <button onclick="deleteList('${list.id}')">åˆªé™¤</button>`;
        container.appendChild(li);
      });
    }

    function addList() {
      const id = generateId();
      const defaultTitle = "æ–°æ¸…å–®"; 
      
      // é—œéµä¿®æ­£ 3: æ–°å¢æ¸…å–®æ™‚ï¼ŒåŒæ­¥å»ºç«‹å­æ¸…å–®é æœŸçš„å…©å€‹ Key
      
      // 1. å„²å­˜é è¨­æ¨™é¡Œ
      localStorage.setItem(id + "_title", defaultTitle); 
      
      // 2. å„²å­˜é è¨­é …ç›® (å­æ¸…å–®é æœŸ [""]ï¼Œé¿å…éŒ¯èª¤)
      localStorage.setItem(id + "_items", JSON.stringify([''])); 
      
      // ç«‹å³å°èˆªè‡³æ–°æ¸…å–®é é¢
      window.location.href = `list.html?id=${encodeURIComponent(id)}`;
      
      // æ³¨æ„ï¼šé€™è£¡ä¸å‘¼å« render()ï¼Œå› ç‚ºé é¢æœƒè·³è½‰
    }
    
    // é—œéµä¿®æ­£ 4: åˆªé™¤æ¸…å–®æ™‚ï¼Œå¿…é ˆåŒæ­¥åˆªé™¤å­æ¸…å–®å„²å­˜çš„æ‰€æœ‰ç›¸é—œ Key
    function deleteList(id) {
      if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹æ¸…å–®å—ï¼Ÿé€™å°‡åŒæ™‚ç§»é™¤æ¸…å–®æ¨™é¡Œå’Œå…§å®¹ã€‚")) return;
      
      // åˆªé™¤æ¨™é¡Œ Key
      localStorage.removeItem(id + "_title");
      
      // åˆªé™¤é …ç›® Key
      localStorage.removeItem(id + "_items");
      
      render(); // é‡æ–°æ¸²æŸ“æ¯æ¸…å–®
    }
    
    document.getElementById("addBtn").addEventListener("click", addList);
    render();
</script>
</body>
</html>
