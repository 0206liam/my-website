<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ æ¸›æ³•ç·´ç¿’æ¸¬é©—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            transition: background 0.05s ease-in-out; 
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
            overflow-y: auto; 
            max-height: 90vh; 
        }

        .container.error-flash {
            background: #ffc0cb;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .start-screen, .quiz-screen, .result-screen, .stats-screen {
            display: none;
        }
        
        .start-screen.active, .quiz-screen.active, .result-screen.active, .stats-screen.active {
            display: block;
        }
        
        .start-btn, .restart-btn, .stats-btn, .back-btn, .reset-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            margin: 5px;
        }

        .stats-btn, .back-btn {
            background: #764ba2;
        }
        
        .reset-btn {
            background: #f44336;
        }
        
        .start-btn:hover, .restart-btn:hover, .stats-btn:hover, .back-btn:hover, .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(102, 126, 234, 0.6);
        }
        
        .timer {
            font-size: 1.5em;
            color: #764ba2;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .progress {
            margin-bottom: 20px;
            color: #666;
            font-size: 1.1em;
        }
        
        .question {
            font-size: 3em;
            color: #333;
            margin: 30px 0;
            font-weight: bold;
        }
        
        .current-score {
            font-size: 1.5em;
            color: #4CAF50;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .hint {
            color: #999;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        .result-score {
            font-size: 4em;
            color: #667eea;
            margin: 30px 0;
            font-weight: bold;
        }
        
        .result-time {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 30px;
        }
        
        .feedback {
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .correct-answer {
            color: #4CAF50;
            margin-top: 10px;
            font-size: 1.2em;
        }

        .stats-screen table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .stats-screen th, .stats-screen td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .stats-screen th {
            background-color: #f2f2f2;
            color: #764ba2;
        }

        .stats-screen td:nth-child(2) {
            text-align: left;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§® åŠ æ¸›æ³•ç·´ç¿’æ¸¬é©—</h1>
        
        <div class="start-screen active">
            <p style="font-size: 1.2em; margin-bottom: 30px; color: #666;">
                æº–å‚™å¥½æŒ‘æˆ°10é¡ŒåŠ æ¸›æ³•äº†å—ï¼Ÿ<br>
                åªéœ€è¦è¼¸å…¥å€‹ä½æ•¸å­—å³å¯ï¼
            </p>
            <div>
                <button class="start-btn" onclick="startQuiz()">é–‹å§‹ä½œç­”</button>
                <button class="stats-btn" onclick="showStats()">ç­”é¡Œçµ±è¨ˆ</button>
            </div>
        </div>
        
        <div class="stats-screen">
            <h2>ğŸ“Š é¡Œç›®ç´¯ç©è©•åˆ†çµ±è¨ˆ</h2>
            <p style="font-size: 0.9em; color: #764ba2; margin-bottom: 15px;">
                è©•åˆ†æ¨™æº–ï¼š<br>
                â€¢ ç­”å° â‰¤2.5ç§’ï¼š-ç§’æ•¸<br>
                â€¢ ç­”å° >2.5ç§’ï¼š-ç§’æ•¸ - 2ï¼ˆæœ€ä½ç‚º -10ï¼‰<br>
                â€¢ ç­”éŒ¯ï¼š-10<br>
                ï¼ˆå¹³å‡è©•åˆ† = ç´¯è¨ˆè©•åˆ† / ç¸½æ¬¡æ•¸ï¼‰<br>
                â€¢ ç•¶é¡Œç›®ç­”é¡Œæ¬¡æ•¸æ»¿5æ¬¡æ™‚ï¼Œè©²é¡Œçµ±è¨ˆæœƒé‡ç½®
            </p>
            <div style="max-height: 300px; overflow-y: scroll;">
                <table id="statsTable"></table>
            </div>
            
            <div style="margin-top: 20px;">
                <button class="back-btn" onclick="goBackToStart()">è¿”å›</button>
                <button class="reset-btn" onclick="resetStats()">æ¸…é™¤çµ±è¨ˆç´€éŒ„</button>
            </div>
        </div>
        
        <div class="quiz-screen">
            <div class="timer">â±ï¸ <span id="time">00:00</span></div>
            <div class="progress">ç¬¬ <span id="current">1</span> / 10 é¡Œ</div>
            <div class="current-score">å¾—åˆ†ï¼š<span id="currentScore">0</span> åˆ†</div>
            <div class="question" id="question">11 + 2 = ?</div>
            <div class="correct-answer" id="feedback"></div>
            <div class="hint">è«‹æŒ‰éµç›¤ 0-9 ä½œç­”</div>
        </div>
        
        <div class="result-screen">
            <div class="feedback" id="finalFeedback">ğŸ‰</div>
            <div class="result-score"><span id="score">0</span> åˆ†</div>
            <div class="result-time">ç”¨æ™‚ï¼š<span id="finalTime">00:00</span></div>
            <button class="restart-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // é¡Œåº« - å…±56é¡Œ
        const originalQuestions = [
            // åŠ æ³•é¡Œç›® (20é¡Œ)
            {q: "9 + 2", a: 1, type: "addition"}, // 11 â†’ å€‹ä½æ•¸1
            {q: "8 + 3", a: 1, type: "addition"}, // 11 â†’ å€‹ä½æ•¸1
            {q: "7 + 4", a: 1, type: "addition"}, // 11 â†’ å€‹ä½æ•¸1
            {q: "6 + 5", a: 1, type: "addition"}, // 11 â†’ å€‹ä½æ•¸1
            {q: "9 + 3", a: 2, type: "addition"}, // 12 â†’ å€‹ä½æ•¸2
            {q: "8 + 4", a: 2, type: "addition"}, // 12 â†’ å€‹ä½æ•¸2
            {q: "7 + 5", a: 2, type: "addition"}, // 12 â†’ å€‹ä½æ•¸2
            {q: "6 + 6", a: 2, type: "addition"}, // 12 â†’ å€‹ä½æ•¸2
            {q: "9 + 4", a: 3, type: "addition"}, // 13 â†’ å€‹ä½æ•¸3
            {q: "8 + 5", a: 3, type: "addition"}, // 13 â†’ å€‹ä½æ•¸3
            {q: "7 + 6", a: 3, type: "addition"}, // 13 â†’ å€‹ä½æ•¸3
            {q: "9 + 5", a: 4, type: "addition"}, // 14 â†’ å€‹ä½æ•¸4
            {q: "8 + 6", a: 4, type: "addition"}, // 14 â†’ å€‹ä½æ•¸4
            {q: "7 + 7", a: 4, type: "addition"}, // 14 â†’ å€‹ä½æ•¸4
            {q: "9 + 6", a: 5, type: "addition"}, // 15 â†’ å€‹ä½æ•¸5
            {q: "8 + 7", a: 5, type: "addition"}, // 15 â†’ å€‹ä½æ•¸5
            {q: "9 + 7", a: 6, type: "addition"}, // 16 â†’ å€‹ä½æ•¸6
            {q: "8 + 8", a: 6, type: "addition"}, // 16 â†’ å€‹ä½æ•¸6
            {q: "9 + 8", a: 7, type: "addition"}, // 17 â†’ å€‹ä½æ•¸7
            {q: "9 + 9", a: 8, type: "addition"}, // 18 â†’ å€‹ä½æ•¸8
            
            // æ¸›æ³•é¡Œç›® (36é¡Œ)
            {q: "11 âˆ’ 2", a: 9, type: "subtraction"},
            {q: "11 âˆ’ 3", a: 8, type: "subtraction"},
            {q: "11 âˆ’ 4", a: 7, type: "subtraction"},
            {q: "11 âˆ’ 5", a: 6, type: "subtraction"},
            {q: "11 âˆ’ 6", a: 5, type: "subtraction"},
            {q: "11 âˆ’ 7", a: 4, type: "subtraction"},
            {q: "11 âˆ’ 8", a: 3, type: "subtraction"},
            {q: "11 âˆ’ 9", a: 2, type: "subtraction"},
            {q: "12 âˆ’ 3", a: 9, type: "subtraction"},
            {q: "12 âˆ’ 4", a: 8, type: "subtraction"},
            {q: "12 âˆ’ 5", a: 7, type: "subtraction"},
            {q: "12 âˆ’ 6", a: 6, type: "subtraction"},
            {q: "12 âˆ’ 7", a: 5, type: "subtraction"},
            {q: "12 âˆ’ 8", a: 4, type: "subtraction"},
            {q: "12 âˆ’ 9", a: 3, type: "subtraction"},
            {q: "13 âˆ’ 4", a: 9, type: "subtraction"},
            {q: "13 âˆ’ 5", a: 8, type: "subtraction"},
            {q: "13 âˆ’ 6", a: 7, type: "subtraction"},
            {q: "13 âˆ’ 7", a: 6, type: "subtraction"},
            {q: "13 âˆ’ 8", a: 5, type: "subtraction"},
            {q: "13 âˆ’ 9", a: 4, type: "subtraction"},
            {q: "14 âˆ’ 5", a: 9, type: "subtraction"},
            {q: "14 âˆ’ 6", a: 8, type: "subtraction"},
            {q: "14 âˆ’ 7", a: 7, type: "subtraction"},
            {q: "14 âˆ’ 8", a: 6, type: "subtraction"},
            {q: "14 âˆ’ 9", a: 5, type: "subtraction"},
            {q: "15 âˆ’ 6", a: 9, type: "subtraction"},
            {q: "15 âˆ’ 7", a: 8, type: "subtraction"},
            {q: "15 âˆ’ 8", a: 7, type: "subtraction"},
            {q: "15 âˆ’ 9", a: 6, type: "subtraction"},
            {q: "16 âˆ’ 7", a: 9, type: "subtraction"},
            {q: "16 âˆ’ 8", a: 8, type: "subtraction"},
            {q: "16 âˆ’ 9", a: 7, type: "subtraction"},
            {q: "17 âˆ’ 8", a: 9, type: "subtraction"},
            {q: "17 âˆ’ 9", a: 8, type: "subtraction"},
            {q: "18 âˆ’ 9", a: 9, type: "subtraction"}
        ];
        
        const TOTAL_QUESTIONS = 10;
        const SCORE_PER_QUESTION = 100 / TOTAL_QUESTIONS; // 10åˆ†ä¸€é¡Œ
        const RESET_AFTER_ATTEMPTS = 5; // ç­”é¡Œæ¬¡æ•¸é”åˆ°5æ¬¡æ™‚é‡ç½®
        
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let startTime;
        let questionStartTime;
        let timerInterval;
        let container = document.querySelector('.container'); 
        
        let quizStats = {
            questions: []
        };

        function initializeStats() {
            quizStats.questions = originalQuestions.map(q => ({
                q: q.q,
                type: q.type,
                totalCumulativeScore: 0,
                totalAttempts: 0,
                totalCorrectTime: 0,
                errorCount: 0,
                // æš«å­˜é‡ç½®å‰çš„è©•åˆ†è³‡æ–™
                previousCumulativeScore: 0,
                previousAttempts: 0
            }));
        }

        function loadStats() {
            const storedStats = localStorage.getItem('arithmeticQuizStats');
            if (storedStats) {
                try {
                    const loadedStats = JSON.parse(storedStats);
                    if (
                        loadedStats &&
                        Array.isArray(loadedStats.questions) &&
                        loadedStats.questions.length === originalQuestions.length
                    ) {
                        // ç¢ºä¿æ–°ç‰ˆæœ¬çš„è³‡æ–™çµæ§‹ç›¸å®¹æ€§
                        quizStats.questions = loadedStats.questions.map(item => ({
                            ...item,
                            previousCumulativeScore: item.previousCumulativeScore || 0,
                            previousAttempts: item.previousAttempts || 0
                        }));
                        return;
                    }
                } catch (e) {
                    console.warn('Invalid stats data, resetting.');
                }
            }
            initializeStats();
        }

        function saveStats() {
            localStorage.setItem('arithmeticQuizStats', JSON.stringify(quizStats));
        }

        function resetStats() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´¯ç©çš„ç­”é¡Œç´€éŒ„å—ï¼Ÿæ¸…é™¤å¾Œå°‡ç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('arithmeticQuizStats');
                initializeStats();
                saveStats();       
                location.reload(); 
            }
        }

        function goBackToStart() {
            document.querySelector('.stats-screen').classList.remove('active');
            document.querySelector('.start-screen').classList.add('active');
        }

        function showStats() {
            loadStats();
            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.stats-screen').classList.add('active');
            
            // è¨ˆç®—å¹³å‡è©•åˆ†ä¸¦æ’åºï¼ˆä½¿ç”¨æš«å­˜è³‡æ–™ï¼‰
            const sortedStats = [...quizStats.questions].sort((a, b) => {
                // è¨ˆç®—é¡¯ç¤ºç”¨çš„å¹³å‡è©•åˆ†ï¼ˆåŒ…å«æš«å­˜è³‡æ–™ï¼‰
                const avgScoreA = calculateDisplayAverageScore(a);
                const avgScoreB = calculateDisplayAverageScore(b);
                return avgScoreA - avgScoreB;
            });

            const tableBody = document.getElementById('statsTable');
            let tableHTML = `
                <tr>
                    <th>#</th>
                    <th>é¡Œç›®</th>
                    <th>é¡å‹</th>
                    <th>ç•¶å‰è©•åˆ†</th>
                    <th>å¹³å‡è©•åˆ†</th>
                    <th>ç­”é¡Œæ¬¡æ•¸</th>
                </tr>
            `;

            sortedStats.forEach((item, index) => {
                const displayAvgScore = calculateDisplayAverageScore(item).toFixed(2);
                
                tableHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.q} = ?</td>
                        <td>${item.type === "addition" ? "åŠ æ³•" : "æ¸›æ³•"}</td>
                        <td>${item.totalCumulativeScore.toFixed(2)}</td>
                        <td>${displayAvgScore}</td>
                        <td>${item.totalAttempts}</td>
                    </tr>
                `;
            });

            tableBody.innerHTML = tableHTML;
        }

        // è¨ˆç®—é¡¯ç¤ºç”¨çš„å¹³å‡è©•åˆ†ï¼ˆåŒ…å«æš«å­˜è³‡æ–™ï¼‰
        function calculateDisplayAverageScore(statsItem) {
            if (statsItem.previousAttempts > 0) {
                // å¦‚æœæœ‰æš«å­˜è³‡æ–™ï¼Œä½¿ç”¨æš«å­˜è³‡æ–™è¨ˆç®—å¹³å‡è©•åˆ†
                return statsItem.previousCumulativeScore / statsItem.previousAttempts;
            } else if (statsItem.totalAttempts > 0) {
                // å¦‚æœæ²’æœ‰æš«å­˜è³‡æ–™ä½†ç•¶å‰æœ‰ç­”é¡Œç´€éŒ„ï¼Œä½¿ç”¨ç•¶å‰è³‡æ–™
                return statsItem.totalCumulativeScore / statsItem.totalAttempts;
            } else {
                // å¦‚æœéƒ½æ²’æœ‰è³‡æ–™ï¼Œè¨­ç‚º0
                return 0;
            }
        }

        // æ ¹æ“šçµ±è¨ˆæ•¸æ“šé¸æ“‡é¡Œç›®
        function selectQuestions() {
            loadStats();
            
            // è¤‡è£½é¡Œåº«å’Œçµ±è¨ˆæ•¸æ“š
            const questionPool = [...originalQuestions];
            const statsPool = [...quizStats.questions];
            
            // è¨ˆç®—æ¯å€‹é¡Œç›®çš„å¹³å‡è©•åˆ†ï¼ˆç”¨æ–¼å‡ºé¡Œé‚è¼¯ï¼Œä¸ä½¿ç”¨æš«å­˜è³‡æ–™ï¼‰
            const questionsWithStats = questionPool.map((q, index) => {
                const stat = statsPool[index];
                const avgScore = stat.totalAttempts > 0 ? 
                    (stat.totalCumulativeScore / stat.totalAttempts) : 0;
                
                return {
                    ...q,
                    originalIndex: index,
                    totalAttempts: stat.totalAttempts,
                    avgScore: avgScore // é€™è£¡ä½¿ç”¨ç•¶å‰å¯¦éš›çš„è©•åˆ†ï¼Œä¸æ˜¯æš«å­˜è³‡æ–™
                };
            });
            
            // å„ªå…ˆé¸æ“‡å¾æœªå‡ºéçš„é¡Œç›®ï¼ˆç­”é¡Œæ¬¡æ•¸ç‚º0ï¼‰
            const neverAttempted = questionsWithStats.filter(q => q.totalAttempts === 0);
            
            // å¦‚æœå¾æœªå‡ºéçš„é¡Œç›®ä¸è¶³10é¡Œï¼Œå‰‡å¾å‰©é¤˜é¡Œç›®ä¸­é¸æ“‡å¹³å‡è©•åˆ†æœ€ä½çš„
            let selectedQuestions = [];
            
            if (neverAttempted.length >= TOTAL_QUESTIONS) {
                // å¾æœªå‡ºéçš„é¡Œç›®è¶³å¤ ï¼Œéš¨æ©Ÿé¸æ“‡10é¡Œ
                selectedQuestions = shuffleArray(neverAttempted).slice(0, TOTAL_QUESTIONS);
            } else {
                // å…ˆåŠ å…¥æ‰€æœ‰å¾æœªå‡ºéçš„é¡Œç›®
                selectedQuestions = [...neverAttempted];
                
                // å¾å‰©é¤˜é¡Œç›®ä¸­é¸æ“‡å¹³å‡è©•åˆ†æœ€ä½çš„
                const remainingQuestions = questionsWithStats.filter(q => q.totalAttempts > 0);
                
                // æŒ‰å¹³å‡è©•åˆ†æ’åºï¼ˆå¾ä½åˆ°é«˜ï¼‰
                remainingQuestions.sort((a, b) => a.avgScore - b.avgScore);
                
                // é¸æ“‡éœ€è¦çš„é¡Œç›®æ•¸é‡
                const needed = TOTAL_QUESTIONS - selectedQuestions.length;
                selectedQuestions = [...selectedQuestions, ...remainingQuestions.slice(0, needed)];
                
                // éš¨æ©Ÿæ‰“äº‚æœ€çµ‚é¸æ“‡çš„é¡Œç›®
                selectedQuestions = shuffleArray(selectedQuestions);
            }
            
            return selectedQuestions;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function startQuiz() {
            currentQuestions = selectQuestions();
            currentIndex = 0;
            score = 0;
            startTime = Date.now();
            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.quiz-screen').classList.add('active');
            showQuestion();
            startTimer();
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('time').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }
        
        let feedbackTimeout;
        
        function showQuestion() {
            const q = currentQuestions[currentIndex];
            document.getElementById('question').textContent = `${q.q} = ?`;
            document.getElementById('current').textContent = currentIndex + 1;
            document.getElementById('currentScore').textContent = Math.round(score);
            questionStartTime = Date.now();
        }
        
        function submitAnswer(userAnswer) {
            const timeElapsed = (Date.now() - questionStartTime) / 1000;
            const currentQ = currentQuestions[currentIndex];
            const correctAnswer = currentQ.a;
            
            let cumulativePointChange = 0;
            
            if (feedbackTimeout) {
                clearTimeout(feedbackTimeout);
                document.getElementById('feedback').textContent = '';
            }
            
            if (userAnswer === correctAnswer) {
                score += SCORE_PER_QUESTION;

                // è©•åˆ†è¨ˆç®—
                let rawScore;
                if (timeElapsed > 2.5) {
                    rawScore = -(timeElapsed + 2);
                } else {
                    rawScore = -timeElapsed;
                }
                // è©•åˆ†ä¸å¾—ä½æ–¼ -10ï¼ˆèˆ‡ç­”éŒ¯åŒåˆ†ï¼‰
                cumulativePointChange = Math.max(-10, rawScore);

                document.getElementById('currentScore').textContent = Math.round(score);
                document.getElementById('feedback').textContent = 'âœ“';
                document.getElementById('feedback').style.color = '#4CAF50';
            } else {
                cumulativePointChange = -10;
                container.classList.add('error-flash');
                setTimeout(() => {
                    container.classList.remove('error-flash');
                }, 50); 
                document.getElementById('feedback').textContent = `âœ— ${correctAnswer}`;
                document.getElementById('feedback').style.color = '#f44336';
            }
            
            const statsIndex = currentQ.originalIndex; 
            
            if (statsIndex !== undefined && statsIndex !== -1) {
                const statsItem = quizStats.questions[statsIndex];
                
                // æª¢æŸ¥æ˜¯å¦éœ€è¦é‡ç½®è©²é¡Œçµ±è¨ˆ
                if (statsItem.totalAttempts + 1 >= RESET_AFTER_ATTEMPTS) {
                    // é‡ç½®å‰å…ˆä¿å­˜æš«å­˜è³‡æ–™
                    statsItem.previousCumulativeScore = statsItem.totalCumulativeScore + cumulativePointChange;
                    statsItem.previousAttempts = statsItem.totalAttempts + 1;
                    
                    // é‡ç½®è©²é¡Œçµ±è¨ˆ
                    statsItem.totalCumulativeScore = 0;
                    statsItem.totalAttempts = 0;
                    statsItem.totalCorrectTime = 0;
                    statsItem.errorCount = 0;
                } else {
                    // æ­£å¸¸æ›´æ–°çµ±è¨ˆ
                    statsItem.totalCumulativeScore = parseFloat((statsItem.totalCumulativeScore + cumulativePointChange).toFixed(2));
                    statsItem.totalAttempts++;
                    if (userAnswer === correctAnswer) {
                        statsItem.totalCorrectTime += timeElapsed;
                    } else {
                        statsItem.errorCount++;
                    }
                }
                
                saveStats(); 
            }
            
            feedbackTimeout = setTimeout(() => {
                document.getElementById('feedback').textContent = '';
            }, 800);
            
            currentIndex++;
            if (currentIndex < TOTAL_QUESTIONS) {
                setTimeout(() => showQuestion(), 50); 
            } else {
                setTimeout(() => showResult(), 800);
            }
        } 
        
        function showResult() {
            clearInterval(timerInterval);
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.querySelector('.quiz-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');
            
            document.getElementById('score').textContent = Math.round(score);
            document.getElementById('finalTime').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            let feedback = '';
            if (score >= 99) feedback = 'ğŸ† å®Œç¾ï¼æ»¿åˆ†ï¼';
            else if (score >= 90) feedback = 'ğŸŒŸ å¤ªæ£’äº†ï¼';
            else if (score >= 80) feedback = 'ğŸ‘ å¾ˆå¥½ï¼';
            else if (score >= 70) feedback = 'ğŸ˜Š ä¸éŒ¯å–”ï¼';
            else feedback = 'ğŸ’ª ç¹¼çºŒåŠ æ²¹ï¼';
            
            document.getElementById('finalFeedback').textContent = feedback;
        }

        document.addEventListener('keydown', function(e) {
            const isEnter = (e.key === 'Enter' || e.keyCode === 13);
            if (document.querySelector('.start-screen').classList.contains('active') && isEnter) {
                startQuiz();
                return; 
            }
            if (document.querySelector('.result-screen').classList.contains('active') && isEnter) {
                location.reload();
                return;
            }
            if (document.querySelector('.quiz-screen').classList.contains('active')) {
                const key = e.key;
                if (key >= '0' && key <= '9') {
                    submitAnswer(parseInt(key));
                }
            }
        });
        
        loadStats();
    </script>
</body>
</html>