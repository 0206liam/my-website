<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¬›ç¨¿é–±è®€å™¨ - å°ˆæ¥­ç©©å®šç‰ˆ</title>
  <style>
    :root { --ui-scale: 1; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: sans-serif;
      background: #1a1a1a;
      color: #fff;
      overflow: hidden;
      width: 100vw;
      height: 100dvh;
    }
    
    #viewport-fixer { position: relative; width: 100%; height: 100%; overflow: hidden; }

    #container {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .page {
      min-width: 100vw;
      height: 100dvh;
      overflow-y: auto;
      overflow-x: auto;
      /* å·¦å³é–“è·ç¸®å°åˆ° 8pxï¼Œæœ€å¤§åŒ–é¡¯ç¤ºç©ºé–“ */
      padding: 70px 8px 80px;
      -webkit-overflow-scrolling: touch;
    }

    /* UI å…ƒä»¶ï¼šå³ä¸Šæ§åˆ¶å€ */
    .controls {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 9999;
      display: flex;
      gap: 8px;
      transform-origin: top right;
    }

    /* UI å…ƒä»¶ï¼šå·¦ä¸Šæ§åˆ¶å€ (æ–°å¢èˆ‡åˆªé™¤) */
    .controls-left {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 9999;
      display: flex;
      gap: 8px;
      transform-origin: top left;
    }

    .page-number {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      background: rgba(0,0,0,0.6);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 14px;
      backdrop-filter: blur(5px);
      transform-origin: bottom center;
    }

    button {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 16px;
      backdrop-filter: blur(8px);
    }

    .btn-danger { background: rgba(231, 76, 60, 0.5); }
    .btn-success { background: rgba(46, 204, 113, 0.5); }

    .edit-area {
      width: 100%;
      min-height: 60dvh;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      padding: 15px;
      border-radius: 8px;
      line-height: 1.6;
      resize: none;
    }

    .page-content {
      line-height: 1.8;
      white-space: pre-wrap;
      word-wrap: break-word;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="viewport-fixer">
  <div class="controls-left" id="ui-left">
    <button class="btn-success" onclick="addPageBefore()">ï¼‹</button>
    <button class="btn-danger" onclick="deleteCurrentPage()">ğŸ—‘ï¸</button>
  </div>

  <div class="controls" id="ui-controls">
    <button onclick="changeFontSize(-2)">å°</button>
    <button onclick="changeFontSize(2)">å¤§</button>
    <button id="editBtn" onclick="toggleEdit()" style="background: #3498db;">âœï¸</button>
  </div>

  <div id="container"></div>
  <div class="page-number" id="ui-pagenum">1 / 1</div>
</div>

<script>
  let pages = JSON.parse(localStorage.getItem('speechPages')) || ['æ­¡è¿ä½¿ç”¨ï¼è«‹é»æ“Šç·¨è¼¯æŒ‰éµã€‚', ''];
  let currentPage = parseInt(localStorage.getItem('currentPage')) || 0;
  let fontSize = parseInt(localStorage.getItem('fontSize')) || 20;
  let isEditMode = false;

  // --- è§£æ±ºç¸®æ”¾æ ¸å¿ƒé‚è¼¯ (åŒ…å«å·¦å´ UI åŒæ­¥) ---
  function syncUI() {
    const vv = window.visualViewport;
    if (!vv) return;

    const controls = document.getElementById('ui-controls');
    const leftControls = document.getElementById('ui-left');
    const pagenum = document.getElementById('ui-pagenum');
    
    const scale = 1 / vv.scale;
    
    // å³å´æŒ‰éˆ•åŒæ­¥
    controls.style.transform = `scale(${scale})`;
    controls.style.top = `${vv.offsetTop + (15 * scale)}px`;
    controls.style.right = `${(window.innerWidth - (vv.offsetLeft + vv.width)) + (15 * scale)}px`;

    // å·¦å´æŒ‰éˆ•åŒæ­¥ (ï¼‹ èˆ‡ ğŸ—‘ï¸)
    leftControls.style.transform = `scale(${scale})`;
    leftControls.style.top = `${vv.offsetTop + (15 * scale)}px`;
    leftControls.style.left = `${vv.offsetLeft + (15 * scale)}px`;

    // é ç¢¼åŒæ­¥
    pagenum.style.transform = `translateX(-50%) scale(${scale})`;
    pagenum.style.left = `${vv.offsetLeft + (vv.width / 2)}px`;
    pagenum.style.bottom = `${(window.innerHeight - (vv.offsetTop + vv.height)) + (20 * scale)}px`;
  }

  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', syncUI);
    window.visualViewport.addEventListener('scroll', syncUI);
  }

  // --- æ–°å¢çš„åŠŸèƒ½ï¼šå‰æ’é é¢èˆ‡åˆªé™¤ ---
  function addPageBefore() {
    pages.splice(currentPage, 0, "");
    saveAndRender();
  }

  function deleteCurrentPage() {
    if (pages.length <= 1) {
      pages = [""]; 
    } else {
      if (confirm("ç¢ºå®šè¦åˆªé™¤ç•¶å‰é é¢å—ï¼Ÿ")) {
        pages.splice(currentPage, 1);
        if (currentPage >= pages.length) currentPage = pages.length - 1;
      } else { return; }
    }
    saveAndRender();
  }

  function saveAndRender() {
    localStorage.setItem('speechPages', JSON.stringify(pages));
    render();
  }

  // --- åŸæœ‰åŠŸèƒ½æ•´åˆ ---
  function render() {
    const container = document.getElementById('container');
    container.innerHTML = '';
    
    pages.forEach((content, i) => {
      const div = document.createElement('div');
      div.className = 'page';
      
      if (isEditMode) {
        const txt = document.createElement('textarea');
        txt.className = 'edit-area';
        txt.style.fontSize = fontSize + 'px';
        txt.value = content;
        txt.oninput = (e) => {
          pages[i] = e.target.value;
          localStorage.setItem('speechPages', JSON.stringify(pages));
        };
        div.appendChild(txt);
      } else {
        const p = document.createElement('div');
        p.className = 'page-content';
        p.style.fontSize = fontSize + 'px';
        p.textContent = content || (i === pages.length -1 ? 'ï¼ˆçµæŸï¼‰' : 'ï¼ˆç©ºç™½é ï¼‰');
        div.appendChild(p);
      }
      container.appendChild(div);
    });
    updatePos();
  }

  function updatePos() {
    const container = document.getElementById('container');
    container.style.transform = `translateX(-${currentPage * 100}vw)`;
    document.getElementById('ui-pagenum').textContent = `${currentPage + 1} / ${pages.length}`;
    localStorage.setItem('currentPage', currentPage);
    syncUI();
  }

  function changeFontSize(delta) {
    fontSize = Math.max(12, Math.min(60, fontSize + delta));
    localStorage.setItem('fontSize', fontSize);
    render();
  }

  function toggleEdit() {
    isEditMode = !isEditMode;
    document.getElementById('editBtn').textContent = isEditMode ? 'âœ“' : 'âœï¸';
    render();
  }

  let tsX = 0;
  document.addEventListener('touchstart', e => {
    if (window.visualViewport && window.visualViewport.scale > 1.05) return;
    tsX = e.touches[0].clientX;
  }, {passive: true});

  document.addEventListener('touchend', e => {
    if (isEditMode || (window.visualViewport && window.visualViewport.scale > 1.05)) return;
    const teX = e.changedTouches[0].clientX;
    const delta = tsX - teX;
    if (Math.abs(delta) > 80) {
      if (delta > 0 && currentPage < pages.length - 1) currentPage++;
      else if (delta < 0 && currentPage > 0) currentPage--;
      updatePos();
    }
  });

  render();
  setTimeout(syncUI, 100);
</script>
</body>
</html>
