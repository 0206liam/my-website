<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¬›ç¨¿é–±è®€å™¨ - çµ±ä¸€è¨­è¨ˆç‰ˆ</title>
  <style>
    :root { --ui-scale: 1; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: sans-serif;
      background: #1a1a1a;
      color: #fff;
      overflow: hidden;
      width: 100vw;
      height: 100dvh;
    }
    
    #viewport-fixer { position: relative; width: 100%; height: 100%; overflow: hidden; }

    #container {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .page {
      min-width: 100vw;
      height: 100dvh;
      overflow-y: auto;
      overflow-x: auto;
      padding: 70px 5px 80px;
      -webkit-overflow-scrolling: touch;
    }

    /* çµ±ä¸€ UI æ§åˆ¶å€æ¨£å¼ */
    .controls-group {
      position: fixed;
      top: 15px;
      z-index: 9999;
      display: flex;
      gap: 8px;
    }

    #ui-left { left: 15px; transform-origin: top left; }
    #ui-right { right: 15px; transform-origin: top right; }

    .page-number {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      background: rgba(0,0,0,0.6);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 14px;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      transform-origin: bottom center;
    }

    /* çµ±ä¸€æŒ‰éˆ•æ¨£å¼ */
    button {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 16px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      cursor: pointer;
      min-width: 44px; /* ç¢ºä¿é»æ“Šç¯„åœ */
    }

    button:active {
      background: rgba(255,255,255,0.3);
    }

    /* ç·¨è¼¯æ¨¡å¼å•Ÿå‹•æ™‚ï¼Œâœï¸ æŒ‰éˆ•ç¨å¾®åŠ äº®ä½œç‚ºæé†’ */
    #editBtn.active {
      background: rgba(255,255,255,0.4);
      border-color: rgba(255,255,255,0.8);
    }

    .edit-area {
      width: 100%;
      min-height: 60dvh;
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
      padding: 15px;
      border-radius: 8px;
      line-height: 1.6;
      resize: none;
      outline: none;
    }

    .page-content {
      line-height: 1.8;
      white-space: pre-wrap;
      word-wrap: break-word;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="viewport-fixer">
  <div class="controls-group" id="ui-left">
    <button onclick="addPageBefore()">ï¼‹</button>
    <button onclick="deleteCurrentPage()">ğŸ—‘ï¸</button>
  </div>

  <div class="controls-group" id="ui-right">
    <button onclick="changeFontSize(-2)">å°</button>
    <button onclick="changeFontSize(2)">å¤§</button>
    <button id="editBtn" onclick="toggleEdit()">âœï¸</button>
  </div>

  <div id="container"></div>
  <div class="page-number" id="ui-pagenum">1 / 1</div>
</div>

<script>
  let pages = JSON.parse(localStorage.getItem('speechPages')) || ['æ­¡è¿ä½¿ç”¨ï¼è«‹é»æ“Š âœï¸ æŒ‰éˆ•é–‹å§‹ç·¨è¼¯ã€‚', ''];
  let currentPage = parseInt(localStorage.getItem('currentPage')) || 0;
  let fontSize = parseInt(localStorage.getItem('fontSize')) || 20;
  let isEditMode = false;

  function syncUI() {
    const vv = window.visualViewport;
    if (!vv) return;

    const left = document.getElementById('ui-left');
    const right = document.getElementById('ui-right');
    const pagenum = document.getElementById('ui-pagenum');
    
    const scale = 1 / vv.scale;
    const offsetT = vv.offsetTop;
    const offsetL = vv.offsetLeft;

    left.style.transform = `scale(${scale})`;
    left.style.top = `${offsetT + (15 * scale)}px`;
    left.style.left = `${offsetL + (15 * scale)}px`;

    right.style.transform = `scale(${scale})`;
    right.style.top = `${offsetT + (15 * scale)}px`;
    right.style.right = `${(window.innerWidth - (offsetL + vv.width)) + (15 * scale)}px`;

    pagenum.style.transform = `translateX(-50%) scale(${scale})`;
    pagenum.style.left = `${offsetL + (vv.width / 2)}px`;
    pagenum.style.bottom = `${(window.innerHeight - (offsetT + vv.height)) + (20 * scale)}px`;
  }

  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', syncUI);
    window.visualViewport.addEventListener('scroll', syncUI);
  }

  function addPageBefore() {
    pages.splice(currentPage, 0, "");
    saveAndRender();
  }

  function deleteCurrentPage() {
    if (pages.length <= 1) {
      pages = [""]; 
    } else {
      if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ä¸€é å—ï¼Ÿ")) {
        pages.splice(currentPage, 1);
        if (currentPage >= pages.length) currentPage = Math.max(0, pages.length - 1);
      } else { return; }
    }
    saveAndRender();
  }

  function saveAndRender() {
    localStorage.setItem('speechPages', JSON.stringify(pages));
    render();
  }

  function render() {
    const container = document.getElementById('container');
    container.innerHTML = '';
    
    pages.forEach((content, i) => {
      const div = document.createElement('div');
      div.className = 'page';
      
      if (isEditMode) {
        const txt = document.createElement('textarea');
        txt.className = 'edit-area';
        txt.style.fontSize = fontSize + 'px';
        txt.value = content;
        txt.oninput = (e) => {
          pages[i] = e.target.value;
          localStorage.setItem('speechPages', JSON.stringify(pages));
        };
        div.appendChild(txt);
      } else {
        const p = document.createElement('div');
        p.className = 'page-content';
        p.style.fontSize = fontSize + 'px';
        p.textContent = content || (i === pages.length -1 ? 'ï¼ˆçµæŸï¼‰' : 'ï¼ˆç©ºç™½é ï¼‰');
        div.appendChild(p);
      }
      container.appendChild(div);
    });
    updatePos();
  }

  function updatePos() {
    const container = document.getElementById('container');
    container.style.transform = `translateX(-${currentPage * 100}vw)`;
    document.getElementById('ui-pagenum').textContent = `${currentPage + 1} / ${pages.length}`;
    localStorage.setItem('currentPage', currentPage);
    syncUI();
  }

  function changeFontSize(delta) {
    fontSize = Math.max(12, Math.min(60, fontSize + delta));
    localStorage.setItem('fontSize', fontSize);
    render();
  }

  function toggleEdit() {
    isEditMode = !isEditMode;
    const btn = document.getElementById('editBtn');
    btn.textContent = isEditMode ? 'âœ“' : 'âœï¸';
    if (isEditMode) btn.classList.add('active');
    else btn.classList.remove('active');
    render();
  }

  let tsX = 0;
  document.addEventListener('touchstart', e => {
    if (window.visualViewport && window.visualViewport.scale > 1.05) return;
    tsX = e.touches[0].clientX;
  }, {passive: true});

  document.addEventListener('touchend', e => {
    if (isEditMode || (window.visualViewport && window.visualViewport.scale > 1.05)) return;
    const teX = e.changedTouches[0].clientX;
    const delta = tsX - teX;
    if (Math.abs(delta) > 80) {
      if (delta > 0 && currentPage < pages.length - 1) currentPage++;
      else if (delta < 0 && currentPage > 0) currentPage--;
      updatePos();
    }
  });

  render();
  setTimeout(syncUI, 100);
</script>
</body>
</html>
