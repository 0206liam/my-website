<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡å­—å·®ç•°æ¯”å°å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: white; /* æ”¹ç‚ºç´”ç™½èƒŒæ™¯ */
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            /* ç§»é™¤èƒŒæ™¯è‰²ã€é‚Šæ¡†å’Œé™°å½± */
            background: transparent;
            border-radius: 0; /* ç§»é™¤åœ“è§’ */
            padding: 10px; /* æ¸›å°‘å…§é‚Šè· */
            box-shadow: none; /* ç§»é™¤é™°å½± */
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .button-group {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 1000;
            background: white; /* æ”¹ç‚ºç´”ç™½è‰² */
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); /* æ¸›æ·¡é™°å½± */
            border: 1px solid #eee; /* æ·»åŠ æ·ºè‰²é‚Šæ¡† */
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .compare-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .clear-btn {
            background: #f44336;
            color: white;
        }

        .clear-btn:hover {
            background: #d32f2f;
        }

        .content-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 100px;
        }

        .content-box {
            background: #f9f9f9;
            border: 1px solid #ddd; /* æ¸›æ·¡é‚Šæ¡†é¡è‰² */
            border-radius: 8px;
            padding: 15px;
        }

        .content-box h3 {
            margin-bottom: 10px;
            color: #555;
        }

        .editor-wrapper {
            position: relative;
            background: white;
            border-radius: 5px;
            min-height: 60px;
            overflow: visible;
        }

        .editor-content {
            display: flex;
            min-height: 100%;
        }

        .line-numbers {
            width: 50px;
            background: #f5f5f5;
            border-right: 1px solid #ddd;
            padding: 14px 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #999;
            text-align: right;
            user-select: none;
            flex-shrink: 0;
            min-height: 100%;
        }
        
        .line-number {
            height: 22px;
        }

        .text-area {
            flex: 1;
            min-width: 0;
            min-height: 100%;
            position: relative;
        }

        .content-display,
        .content-textarea {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            font-size: 14px;
            line-height: 22px;
            white-space: pre-wrap;
            word-break: break-word;
            width: 100%;
            min-height: 100%;
            padding: 10px;
            border: none;
            outline: none;
            resize: none;
            overflow: hidden;
        }

        .content-textarea {
            background: transparent;
        }

        .content-display {
            display: none;
            background: transparent;
            overflow: visible;
            overflow-wrap: normal;
            white-space: pre-wrap;
            tab-size: 4;
            -moz-tab-size: 4;
        }

        .editor-wrapper.view-mode .content-textarea {
            display: none;
        }

        .editor-wrapper.view-mode .content-display {
            display: block;
        }

/* åŸå§‹ - æŸ”å’Œé»ƒè‰²ï¼ˆæ”¹ç‚º highlight0ï¼‰ */
.highlight0 {
    background-color: #ffeb3b;      /* æŸ”å’Œé»ƒè‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(255, 235, 59, 0.3);
}

/* 1 - æ·ºè—è‰²ï¼ˆæ¸…çˆ½ï¼‰ */
.highlight1 {
    background-color: #a3d9ff;      /* æ·ºè—è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(163, 217, 255, 0.3);
}

/* 2 - æ·ºç²‰è‰²ï¼ˆæ˜é¡¯ä¸åŒï¼‰ */
.highlight2 {
    background-color: #ffb6c1;      /* æ·ºç²‰è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(255, 182, 193, 0.3);
}

/* 3 - æ·ºç¶ è‰²ï¼ˆæ¸…æ–°ï¼‰ */
.highlight3 {
    background-color: #98fb98;      /* æ·ºç¶ è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(152, 251, 152, 0.3);
}

/* 4 - æ·ºç´«è‰²ï¼ˆå„ªé›…ï¼‰æ›æ›´ç´«è‰² */
.highlight4 {
    background-color:  #c9a0dc;     /* ç´«ç¾…è˜­è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(216, 191, 216, 0.3);
}

/* 5 - æ·ºæ©™è‰²ï¼ˆæº«æš–ï¼‰ç§»æ‰ */
.highlight5 {
    background-color: #ffb380;       /* æ¨™æº–æ©˜è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(255, 204, 153, 0.3);
}

/* 6 - æ·ºé’è‰²ï¼ˆæ°´è—ï¼‰ */
.highlight6 {
    background-color: #afeeee;      /* æ·ºé’è‰² */
    padding: 2px 4px;
    border-radius: 3px;
    box-shadow: 0 0 0 2px rgba(175, 238, 238, 0.3);
}


        .info-message {
            text-align: center;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 8px;
            color: #1976d2;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .no-diff {
            text-align: center;
            padding: 20px;
            background: #c8e6c9;
            border-radius: 8px;
            color: #2e7d32;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            background: rgba(102, 126, 234, 0.9);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            border: none;
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background: rgba(118, 75, 162, 0.9);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æ–‡å­—å·®ç•°æ¯”å°å·¥å…·</h1>

        <div class="button-group">
            <button class="compare-btn" id="compareBtn" onclick="toggleMode()">ğŸ” æ¯”å°å·®ç•°</button>
            <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>

        <div id="message"></div>

        <div class="content-section">
            <div class="content-box">
                <h3>æ–‡ä»¶ A</h3>
                <div class="editor-wrapper" id="wrapperA">
                    <div class="editor-content">
                        <div class="line-numbers" id="lineNumbersA"><div class="line-number">1</div></div>
                        <div class="text-area">
                            <textarea class="content-textarea" id="textA" 
                                      placeholder="è«‹è¼¸å…¥æ–‡å­—..." 
                                      oninput="updateLineNumbers('A'); autoResizeTextarea('A')" 
                                      onscroll="syncLineNumbers('A')"></textarea>
                            <div class="content-display" id="displayA" 
                                 onscroll="syncDisplayScroll('A')"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-box">
                <h3>æ–‡ä»¶ B</h3>
                <div class="editor-wrapper" id="wrapperB">
                    <div class="editor-content">
                        <div class="line-numbers" id="lineNumbersB"><div class="line-number">1</div></div>
                        <div class="text-area">
                            <textarea class="content-textarea" id="textB" 
                                      placeholder="è«‹è¼¸å…¥æ–‡å­—..." 
                                      oninput="updateLineNumbers('B'); autoResizeTextarea('B')" 
                                      onscroll="syncLineNumbers('B')"></textarea>
                            <div class="content-display" id="displayB" 
                                 onscroll="syncDisplayScroll('B')"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="å›åˆ°é ‚éƒ¨">
        <span>â†‘</span>
    </button>

    <script>
        let isViewMode = false;

        // æ ¸å¿ƒå·®ç•°æ¨™è¨˜å‡½æ•¸
function markDifferences(strA, strB) {
    const m = strA.length;
    const n = strB.length;
    const dp = Array(m + 1).fill().map(() => Array(n + 1).fill(0));
    
    // LCS DP å»ºè¡¨
    for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
            if (strA[i - 1] === strB[j - 1]) {
                dp[i][j] = dp[i - 1][j - 1] + 1;
            } else {
                dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
            }
        }
    }
    
    let i = m, j = n;
    let resultA = "";
    let resultB = "";
    
    let diffA = "";
    let diffB = "";
    
    const flushDiff = () => {
        if (diffA || diffB) {
            resultA = `##DIFF_START##${diffA}##DIFF_END##` + resultA;
            resultB = `##DIFF_START##${diffB}##DIFF_END##` + resultB;
            diffA = "";
            diffB = "";
        }
    };
    
    // å›æº¯
    while (i > 0 || j > 0) {
        if (i > 0 && j > 0 && strA[i - 1] === strB[j - 1]) {
            // flush accumulated diff
            flushDiff();
            
            // add matching char
            resultA = strA[i - 1] + resultA;
            resultB = strB[j - 1] + resultB;
            i--;
            j--;
        } else if (i > 0 && (j === 0 || dp[i - 1][j] >= dp[i][j - 1])) {
            // A æœ‰å¤šçš„å­—å…ƒ
            diffA = strA[i - 1] + diffA;
            i--;
        } else {
            // B æœ‰å¤šçš„å­—å…ƒ
            diffB = strB[j - 1] + diffB;
            j--;
        }
    }
    
    // flush remaining diffs
    flushDiff();
    
    return [resultA, resultB];
}



        function autoResizeTextarea(side) {
            const textarea = document.getElementById('text' + side);
            textarea.style.height = 'auto';
            const contentHeight = textarea.scrollHeight;
            textarea.style.height = contentHeight + 'px';
            updateLineNumbers(side);
        }

        function updateLineNumbers(side) {
            const textarea = document.getElementById('text' + side);
            const display = document.getElementById('display' + side);
            const lineNumbers = document.getElementById('lineNumbers' + side);
            const contentElement = isViewMode ? display : textarea;
            if (!contentElement) return;

            const text = contentElement.value ?? contentElement.textContent ?? '';

            const mirror = document.createElement('div');
            const cs = getComputedStyle(contentElement);

            mirror.style.position = 'absolute';
            mirror.style.visibility = 'hidden';
            mirror.style.whiteSpace = 'pre-wrap';
            mirror.style.wordBreak = 'break-word';
            mirror.style.boxSizing = cs.boxSizing;
            mirror.style.font = cs.font;
            mirror.style.letterSpacing = cs.letterSpacing;
            mirror.style.padding = cs.padding;
            mirror.style.border = 'none';
            mirror.style.margin = '0';

            const width = contentElement.clientWidth;
            mirror.style.width = width + 'px';

            document.body.appendChild(mirror);

            mirror.textContent = 'A';
            const lineHeight = mirror.scrollHeight;

            const rawLines = text.split('\n');
            let totalLines = 0;

            for (const line of rawLines) {
                if (line === '') {
                    totalLines += 1;
                    continue;
                }

                mirror.textContent = line;
                const wrapped = Math.max(1, Math.round(mirror.scrollHeight / lineHeight));
                totalLines += wrapped;
            }

            mirror.remove();

            let html = '';
            for (let i = 1; i <= totalLines; i++) {
                html += `<div class="line-number">${i}</div>`;
            }

            lineNumbers.innerHTML = html;
            syncLineNumbers(side);
        }

        function syncLineNumbers(side) {
            const textarea = document.getElementById('text' + side);
            const display = document.getElementById('display' + side);
            const lineNumbers = document.getElementById('lineNumbers' + side);
            const scrollElement = isViewMode ? display : textarea;
            
            if (scrollElement) {
                lineNumbers.scrollTop = scrollElement.scrollTop;
            }
        }

        function syncDisplayScroll(side) {
            syncLineNumbers(side);
        }

        function toggleMode() {
            const wrapperA = document.getElementById('wrapperA');
            const wrapperB = document.getElementById('wrapperB');
            const compareBtn = document.getElementById('compareBtn');
            const message = document.getElementById('message');

            if (!isViewMode) {
                const textA = document.getElementById('textA').value;
                const textB = document.getElementById('textB').value;

                if (!textA || !textB) {
                    message.innerHTML = '<div class="info-message">è«‹è¼¸å…¥å…©å€‹æ–‡ä»¶çš„å…§å®¹</div>';
                    return;
                }

                wrapperA.classList.add('view-mode');
                wrapperB.classList.add('view-mode');
                compareBtn.textContent = 'âœï¸ è¿”å›ç·¨è¼¯';
                compareBtn.style.background = '#4CAF50';
                isViewMode = true;
                
                autoResizeDisplay('A', textA);
                autoResizeDisplay('B', textB);
                updateLineNumbers('A');
                updateLineNumbers('B');
                compareTexts();
            } else {
                wrapperA.classList.remove('view-mode');
                wrapperB.classList.remove('view-mode');
                compareBtn.textContent = 'ğŸ” æ¯”å°å·®ç•°';
                compareBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                isViewMode = false;
                message.innerHTML = '';
                
                updateLineNumbers('A');
                updateLineNumbers('B');
                autoResizeTextarea('A');
                autoResizeTextarea('B');
            }
        }

        function autoResizeDisplay(side, text) {
            const display = document.getElementById('display' + side);
            display.innerHTML = escapeHtml(text);
            display.style.height = 'auto';
            
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
                font-size: 14px;
                line-height: 22px;
                white-space: pre-wrap;
                word-break: break-word;
                width: ${display.clientWidth}px;
                padding: 10px;
                visibility: hidden;
                position: absolute;
            `;
            tempDiv.textContent = text;
            document.body.appendChild(tempDiv);
            
            const contentHeight = tempDiv.scrollHeight;
            document.body.removeChild(tempDiv);
            display.style.height = contentHeight + 'px';
        }

        function compareTexts() {
            const textA = document.getElementById('textA').value;
            const textB = document.getElementById('textB').value;
            const displayA = document.getElementById('displayA');
            const displayB = document.getElementById('displayB');
            const message = document.getElementById('message');

            message.innerHTML = '';

            // ä½¿ç”¨æ–°çš„å·®ç•°æ¨™è¨˜ç®—æ³•
            const [markedA, markedB] = markDifferences(textA, textB);

            // æª¢æŸ¥æ˜¯å¦æœ‰å·®ç•°
            if (markedA.indexOf('##DIFF_START##') === -1) {
                message.innerHTML = '<div class="no-diff">âœ… å…©å€‹æ–‡ä»¶å®Œå…¨ç›¸åŒï¼</div>';
                displayA.innerHTML = escapeHtml(textA);
                displayB.innerHTML = escapeHtml(textB);
            } else {
                // è½‰æ›æ¨™è¨˜ç‚º HTML é«˜äº®
                const highlightedA = convertMarksToHTML(markedA);
                const highlightedB = convertMarksToHTML(markedB);

                displayA.innerHTML = highlightedA;
                displayB.innerHTML = highlightedB;

                // è¨ˆç®—å·®ç•°æ•¸é‡
                const diffCount = (markedA.match(/##DIFF_START##/g) || []).length;
                message.innerHTML = `<div class="info-message">æ‰¾åˆ° ${diffCount} è™•å·®ç•°ï¼ˆå·²ç”¨é¡è‰²æ¨™è¨˜ï¼‰</div>`;
            }
        }

function convertMarksToHTML(markedText) {
    // å…ˆè½‰ç¾© HTMLï¼Œä½†ä¿ç•™æˆ‘å€‘çš„æ¨™è¨˜
    let result = markedText
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/\n/g, '<br>');

    // è¨ˆç®—æ¨™è¨˜æ•¸é‡ä»¥æ±ºå®šé¡è‰²ç´¢å¼•
    let colorIndex = 0;
    
    // å°‡æ¨™è¨˜è½‰æ›ç‚º HTML é«˜äº®ï¼Œä¾åºä½¿ç”¨ä¸åŒé¡è‰²
    result = result.replace(/##DIFF_START##(.*?)##DIFF_END##/g, 
        function(match, diffText) {
            // ä½¿ç”¨ 0-6 å¾ªç’°çš„é¡è‰²ï¼ˆå…±7ç¨®ï¼‰
            const colorClass = 'highlight' + (colorIndex % 7); // highlight0 ~ highlight6
            colorIndex++;
            return `<span class="${colorClass}">${diffText}</span>`;
        });

    return result;
}
        function escapeHtml(text) {
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\n/g, '\n');
        }

        function clearAll() {
            document.getElementById('textA').value = '';
            document.getElementById('textB').value = '';
            document.getElementById('displayA').innerHTML = '';
            document.getElementById('displayB').innerHTML = '';
            document.getElementById('message').innerHTML = '';
            document.getElementById('lineNumbersA').innerHTML = '<div class="line-number">1</div>';
            document.getElementById('lineNumbersB').innerHTML = '<div class="line-number">1</div>';
            
            if (isViewMode) {
                toggleMode();
            } else {
                updateLineNumbers('A');
                updateLineNumbers('B');
                autoResizeTextarea('A');
                autoResizeTextarea('B');
            }
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById('backToTop');
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateLineNumbers('A');
            updateLineNumbers('B');
            autoResizeTextarea('A');
            autoResizeTextarea('B');
            
            const backToTopBtn = document.getElementById('backToTop');
            backToTopBtn.style.display = 'flex';
        });
    </script>
</body>
</html>